import{c as r,b as t,g as l,t as a,F as u,l as g,w as p,v as f,p as _,o as n,d,k as c,_ as h,f as m}from"./index-DwsF5HMj.js";const y={class:"col-12 col-md-8 col-lg-9 overflow-auto overflow-auto d-flex flex-column",ref:"chatView",id:"chatView",style:{"max-height":"80vh",height:"1000px"}},b={class:"border-bottom p-3 d-flex align-items-center position-sticky top-0 bg-white",style:{"z-index":"1"}},k={class:"mb-0"},w={class:"flex-grow-1 p-3",id:"chatArea"},v={key:0,class:"d-flex align-items-start mb-3"},I={key:0,src:h,class:"rounded-circle me-3",alt:"User Profile",width:"40",height:"40"},$={key:1,src:m,class:"rounded-circle me-3",alt:"User Profile",width:"40",height:"40"},x={key:2,src:l,class:"rounded-circle me-3",alt:"User Profile",width:"40",height:"40"},M={class:"p-3 bg-body-secondary rounded-3"},S={class:"mb-0"},V={class:"text-muted"},U={key:1,class:"d-flex align-items-end flex-row-reverse mb-3"},C={key:0,src:h,class:"rounded-circle me-3",alt:"User Profile",width:"40",height:"40"},P={key:1,src:m,class:"rounded-circle me-3",alt:"User Profile",width:"40",height:"40"},D={key:2,src:l,class:"rounded-circle me-3",alt:"User Profile",width:"40",height:"40"},T={class:"p-3 bg-primary text-white rounded-3"},j={class:"mb-0"},A={class:"text-white-50"},B={class:"d-flex"},H={data(){return{inputMessage:"",messages:[],socket:null,id:_(localStorage.getItem("token")).id}},methods:{emitMessage(o){o.preventDefault(),this.inputMessage&&(this.socket.emit("chat message",this.inputMessage,this.id,this.$route.params.id),this.inputMessage="")},async startVideoCall(){const s=await(await fetch("/api/room/call",{method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")}})).json();this.socket.emit("start call",s.roomId,this.$route.params.id),this.$router.push(`/call/${this.$route.params.id}/${s.roomId}`)}},async mounted(){this.socket=this.$store.getters.getSocket,this.socket.emit("read room",this.$route.params.id),this.socket.on("chat message",(o,s)=>{s===this.$route.params.id&&this.messages.push(o)}),this.socket.on("chat init",o=>{this.messages=o})},unmounted(){this.socket.off("chat message"),this.socket.off("chat init")},updated(){const o=this.$refs.chatView;o&&o.scrollHeight>o.offsetHeight&&(o.scrollTop=o.scrollHeight)}},N=Object.assign(H,{__name:"messageComponent",setup(o){return(s,i)=>(n(),r("div",y,[t("div",b,[i[4]||(i[4]=t("img",{src:l,class:"rounded-circle me-3",alt:"Chatting with",width:"40",height:"40"},null,-1)),t("h5",k,a(s.$route.params.name),1),t("button",{class:"ms-auto btn-lg btn text-primary hover-btn rounded-circle",onClick:i[0]||(i[0]=e=>s.startVideoCall())},i[3]||(i[3]=[t("i",{class:"bi bi-camera-video-fill"},null,-1)]))]),(n(!0),r(u,null,g(s.messages,e=>(n(),r("div",w,[e.senderId._id!==s.id?(n(),r("div",v,[e.senderId.gender=="male"?(n(),r("img",I)):d("",!0),e.senderId.gender=="female"?(n(),r("img",$)):d("",!0),e.senderId.gender=="other"||e.senderId.gender==null?(n(),r("img",x)):d("",!0),t("div",M,[t("p",S,[t("strong",null,a(e.senderId.username),1),c(": "+a(e.content),1)]),t("small",V,a(new Date(e.createdAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})),1)])])):d("",!0),e.senderId._id===s.id?(n(),r("div",U,[e.senderId.gender=="male"?(n(),r("img",C)):d("",!0),e.senderId.gender=="female"?(n(),r("img",P)):d("",!0),e.senderId.gender=="other"||e.senderId.gender==null?(n(),r("img",D)):d("",!0),t("div",T,[t("p",j,[i[5]||(i[5]=t("strong",null,"Me",-1)),c(": "+a(e.content),1)]),t("small",A,a(new Date(e.createdAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})),1)])])):d("",!0)]))),256)),t("div",{class:"border-top p-3 mt-auto position-sticky bottom-0",onSubmit:i[2]||(i[2]=(...e)=>s.emitMessage&&s.emitMessage(...e))},[t("form",B,[p(t("input",{type:"text",class:"form-control me-2",placeholder:"Type a message","onUpdate:modelValue":i[1]||(i[1]=e=>s.inputMessage=e)},null,512),[[f,s.inputMessage]]),i[6]||(i[6]=t("button",{type:"submit",class:"btn btn-primary"},"Send",-1))])],32)],512))}});export{N as default};
