import{c as s,b as l,q as r,o as a}from"./index-CZ4AokZQ.js";const d={id:"video-grid"},n={ref:"localVideo"},c={ref:"peerVideo",class:"peerVideo"},h={key:0,class:"bi bi-mic-mute"},u={key:1,class:"bi bi-mic"},p={data(){return{video:null,peerVideo:null,peer:null,socket:null,peers:{},localStream:null,isMuted:!1}},methods:{addVideoStream(t,e){e.srcObject=t,e.addEventListener("loadedmetadata",()=>{e.play()})},mute(){this.localStream&&(this.localStream.getAudioTracks().forEach(t=>{t.enabled=this.isMuted}),this.isMuted=!this.isMuted)},initializeCall(){this.socket=r({auth:{token:localStorage.getItem("token")}}),this.peer=new Peer(void 0,{host:"/",path:"/",port:"3001"}),this.peer.on("open",t=>{console.log(t),this.socket.emit("join-call",this.$route.params.callId,this.$route.params.roomId,t)}),this.video.muted=!0,navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(t=>{this.localStream=t,this.addVideoStream(t,this.video),this.peer.on("call",e=>{e.answer(t),e.on("stream",i=>{this.addVideoStream(i,this.peerVideo)})}),this.socket.on("user-connected",e=>{console.log("calling");const i=this.peer.call(e,t);i.on("stream",o=>{this.addVideoStream(o,this.peerVideo)}),i.on("close",()=>{this.peerVideo.srcObject=null}),this.peers[e]=i}),this.socket.on("user-disconnected",e=>{this.peers[e]&&(this.peers[e].close(),this.peerVideo.srcObject=null),this.$router.back(),alert("Call ended")}),this.socket.on("Invalid",e=>{console.error(e),this.$router.back()})})}},unmounted(){this.peer&&this.peer.destroy(),this.socket&&this.socket.emit("leave call")},mounted(){const t=this.$store.getters.getSocket;t.off("decline call"),t.on("decline call",()=>{console.log("decline call"),alert("Call declined"),this.$router.back()}),this.video=this.$refs.localVideo,this.peerVideo=this.$refs.peerVideo,this.initializeCall()}},k=Object.assign(p,{__name:"CallView",setup(t){return(e,i)=>(a(),s("div",d,[l("video",n,null,512),l("video",c,null,512),l("button",{class:"btn btn-primary position-absolute bottom-0 start-50 mb-5 btn-lg",onClick:i[0]||(i[0]=(...o)=>e.mute&&e.mute(...o))},[e.isMuted?(a(),s("i",u)):(a(),s("i",h))])]))}});export{k as default};
